<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - BAAZARX</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .product-detail {
            max-width: 1200px;
            margin: 100px auto 40px;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .product-images {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .main-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .thumbnail-images {
            display: flex;
            gap: 10px;
            overflow-x: auto;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }

        .thumbnail.active {
            border-color: #667eea;
        }

        .product-info {
            padding: 20px 0;
        }

        .product-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .product-rating-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stars {
            color: #fbbf24;
        }

        .rating-text {
            color: #666;
        }

        .product-price {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
        }

        .product-description {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #555;
            margin-bottom: 30px;
        }

        .variant-section, .color-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .variant-options, .color-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .variant-option, .color-option {
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .variant-option:hover, .color-option:hover {
            border-color: #667eea;
        }

        .variant-option.selected, .color-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .color-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid #ddd;
        }

        .quantity-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
        }

        .quantity-btn {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            color: #667eea;
        }

        .quantity-input {
            border: none;
            width: 60px;
            text-align: center;
            font-size: 1.1rem;
            padding: 10px 5px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn-primary {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .specifications {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .spec-item:last-child {
            border-bottom: none;
        }

        .spec-label {
            font-weight: 600;
            color: #374151;
        }

        .spec-value {
            color: #6b7280;
        }

        .reviews-section {
            grid-column: 1 / -1;
            margin-top: 40px;
        }

        .review-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .reviewer-name {
            font-weight: 600;
            color: #333;
        }

        .review-date {
            color: #666;
            font-size: 0.9rem;
        }

        .review-stars {
            color: #fbbf24;
            margin-bottom: 10px;
        }

        .review-comment {
            color: #555;
            line-height: 1.6;
        }

        .review-item {
            background: white;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .review-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .review-author {
            font-weight: 600;
            color: #333;
        }

        .review-rating {
            color: #fbbf24;
            margin-left: 10px;
        }

        .review-date {
            color: #666;
            font-size: 0.9rem;
            margin-left: auto;
        }

        .review-comment {
            color: #555;
            line-height: 1.6;
        }

        .star {
            font-size: 24px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s ease;
            user-select: none;
        }

        .star:hover,
        .star.active {
            color: #fbbf24;
        }

        .rating-input {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .product-detail {
                grid-template-columns: 1fr;
                gap: 20px;
                margin-top: 80px;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="assets/logo-primary.svg" alt="BAAZARX" style="height: 60px;">
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                <li class="nav-item"><a href="catalog.html" class="nav-link">Catalog</a></li>
                <li class="nav-item"><a href="cart.html" class="nav-link">Cart <span id="cart-count" class="cart-count">0</span></a></li>
                <li class="nav-item user-menu">
                    <div id="user-menu-logged-out">
                        <a href="login.html" class="nav-link" style="margin-right: 15px;">Login</a>
                        <a href="register.html" class="nav-link">Register</a>
                    </div>
                    <div id="user-menu-logged-in" class="user-dropdown" style="display: none;">
                        <span id="user-name" class="user-name"></span>
                        <div class="dropdown-content">
                            <a href="#" onclick="logout()">Logout</a>
                        </div>
                    </div>
                </li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Product Detail -->
    <div class="product-detail">
        <div class="product-images">
            <img id="main-image" src="" alt="Product Image" class="main-image">
            <div class="thumbnail-images" id="thumbnail-images">
                <!-- Thumbnails will be dynamically loaded -->
            </div>
            
            <!-- Specifications moved to left side -->
            <div class="specifications" id="specifications">
                <h3 class="section-title">Specifications</h3>
                <div id="spec-list"></div>
            </div>
        </div>

        <div class="product-info">
            <h1 id="product-title" class="product-title"></h1>
            
            <div class="product-rating-section">
                <div id="product-stars" class="stars"></div>
                <span id="rating-text" class="rating-text"></span>
            </div>

            <div id="product-price" class="product-price"></div>
            
            <p id="product-description" class="product-description"></p>

            <div class="variant-section" id="variant-section" style="display: none;">
                <h3 class="section-title">Storage & RAM</h3>
                <div id="variant-options" class="variant-options"></div>
            </div>

            <div class="color-section" id="color-section" style="display: none;">
                <h3 class="section-title">Colors</h3>
                <div id="color-options" class="color-options"></div>
            </div>

            <div class="quantity-section">
                <span class="section-title">Quantity:</span>
                <div class="quantity-controls">
                    <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                    <input type="number" id="quantity" class="quantity-input" value="1" min="1">
                    <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                </div>
                <span id="stock-info" class="rating-text"></span>
            </div>

            <div class="action-buttons">
                <button class="btn-primary" onclick="addToCart()">
                    <i class="fas fa-cart-plus"></i> Add to Cart
                </button>
                <button class="btn-secondary" onclick="addToWishlist()">
                    <i class="fas fa-heart"></i> Wishlist
                </button>
            </div>
        </div>

        <div class="reviews-section">
            <h2 class="section-title">Customer Reviews</h2>
            
            <!-- Add Review Form -->
            <div class="add-review" style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                <h3 style="margin-bottom: 20px;">Write a Review</h3>
                <form id="reviewForm" style="display: grid; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Your Name:</label>
                        <input type="text" id="reviewerName" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Rating:</label>
                        <div class="rating-input" style="display: flex; gap: 5px;">
                            <span class="star" data-rating="1">★</span>
                            <span class="star" data-rating="2">★</span>
                            <span class="star" data-rating="3">★</span>
                            <span class="star" data-rating="4">★</span>
                            <span class="star" data-rating="5">★</span>
                        </div>
                        <input type="hidden" id="reviewRating" required>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">Your Review:</label>
                        <textarea id="reviewComment" rows="4" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
                    </div>
                    <button type="submit" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 30px; border: none; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: 500;">Submit Review</button>
                </form>
            </div>

            <div id="reviews-list"></div>
        </div>
    </div>

    <script src="js/script.js"></script>
    <script>
        class ProductDetail {
            constructor() {
                this.currentProduct = null;
                this.selectedVariant = null;
                this.selectedColor = null;
                this.quantity = 1;
                this.init();
            }

            async init() {
                console.log('ProductDetail init called');
                const urlParams = new URLSearchParams(window.location.search);
                const productId = urlParams.get('id');
                console.log('Product ID from URL:', productId);
                
                if (productId) {
                    await this.loadProduct(productId);
                } else {
                    console.log('No product ID found, redirecting to catalog');
                    window.location.href = 'catalog.html';
                }
            }

            async loadProduct(id) {
                try {
                    console.log('Loading product with ID:', id);
                    const response = await fetch('../data/products.json');
                    console.log('Fetch response:', response);
                    const data = await response.json();
                    console.log('Products data:', data);
                    this.currentProduct = data.products.find(p => p.id == id);
                    console.log('Found product:', this.currentProduct);
                    
                    if (this.currentProduct) {
                        this.renderProduct();
                    } else {
                        console.log('Product not found, redirecting to catalog');
                        window.location.href = 'catalog.html';
                    }
                } catch (error) {
                    console.error('Error loading product:', error);
                }
            }

            renderProduct() {
                console.log('Rendering product:', this.currentProduct);
                const product = this.currentProduct;
                
                // Basic info
                document.getElementById('product-title').textContent = product.name;
                document.getElementById('product-description').textContent = product.description;
                document.getElementById('product-price').textContent = `৳${product.price.toLocaleString()}`;
                document.getElementById('stock-info').textContent = `${product.stock} in stock`;
                
                // Rating
                document.getElementById('product-stars').innerHTML = this.renderStars(product.rating);
                document.getElementById('rating-text').textContent = `${product.rating} (${product.reviews} reviews)`;
                
                // Main image
                document.getElementById('main-image').src = product.image;
                
                // Variants
                if (product.variants && product.variants.length > 0) {
                    this.renderVariants();
                }
                
                // Colors
                if (product.colors && product.colors.length > 0) {
                    this.renderColors();
                }
                
                // Specifications
                if (product.specifications) {
                    this.renderSpecifications();
                }
                
                // Reviews
                if (product.detailedReviews) {
                    this.loadUserReviews();
                    this.renderReviews();
                }
                
                // Update cart count
                this.updateCartCount();
            }

            renderStars(rating) {
                const fullStars = Math.floor(rating);
                const halfStar = rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);

                return `
                    ${'<i class="fas fa-star"></i>'.repeat(fullStars)}
                    ${halfStar ? '<i class="fas fa-star-half-alt"></i>' : ''}
                    ${'<i class="far fa-star"></i>'.repeat(emptyStars)}
                `;
            }

            renderVariants() {
                const section = document.getElementById('variant-section');
                const container = document.getElementById('variant-options');
                
                section.style.display = 'block';
                container.innerHTML = this.currentProduct.variants.map((variant, index) => `
                    <div class="variant-option ${index === 0 ? 'selected' : ''}" 
                         onclick="productDetail.selectVariant(${index})">
                        ${variant.storage}<br>
                        <small>৳${variant.price.toLocaleString()}</small>
                    </div>
                `).join('');
                
                this.selectedVariant = 0;
            }

            renderColors() {
                const section = document.getElementById('color-section');
                const container = document.getElementById('color-options');
                
                section.style.display = 'block';
                container.innerHTML = this.currentProduct.colors.map((color, index) => `
                    <div class="color-option ${index === 0 ? 'selected' : ''}" 
                         onclick="productDetail.selectColor(${index})">
                        <div class="color-swatch" style="background-color: ${color.hex}"></div>
                        ${color.name}
                    </div>
                `).join('');
                
                this.selectedColor = 0;
                this.updateThumbnails();
            }

            renderSpecifications() {
                const container = document.getElementById('spec-list');
                const specs = this.currentProduct.specifications;
                
                container.innerHTML = Object.entries(specs).map(([key, value]) => `
                    <div class="spec-item">
                        <span class="spec-label">${key.charAt(0).toUpperCase() + key.slice(1)}:</span>
                        <span class="spec-value">${value}</span>
                    </div>
                `).join('');
            }

            renderReviews() {
                const container = document.getElementById('reviews-list');
                
                container.innerHTML = this.currentProduct.detailedReviews.map(review => `
                    <div class="review-item">
                        <div class="review-header">
                            <span class="reviewer-name">${review.user}</span>
                            <span class="review-date">${review.date}</span>
                        </div>
                        <div class="review-stars">${this.renderStars(review.rating)}</div>
                        <p class="review-comment">${review.comment}</p>
                    </div>
                `).join('');
            }

            loadUserReviews() {
                const productId = this.currentProduct.id;
                const userReviews = JSON.parse(localStorage.getItem('userReviews')) || {};
                
                if (userReviews[productId]) {
                    // Add user reviews to the product's existing reviews
                    this.currentProduct.detailedReviews = [
                        ...this.currentProduct.detailedReviews,
                        ...userReviews[productId]
                    ];
                }
            }

            selectVariant(index) {
                // Remove previous selection
                document.querySelectorAll('.variant-option').forEach(el => el.classList.remove('selected'));
                
                // Add new selection
                document.querySelectorAll('.variant-option')[index].classList.add('selected');
                
                this.selectedVariant = index;
                
                // Update price
                const variant = this.currentProduct.variants[index];
                document.getElementById('product-price').textContent = `৳${variant.price.toLocaleString()}`;
            }

            selectColor(index) {
                // Remove previous selection
                document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
                
                // Add new selection
                document.querySelectorAll('.color-option')[index].classList.add('selected');
                
                this.selectedColor = index;
                
                // Update main image
                const color = this.currentProduct.colors[index];
                document.getElementById('main-image').src = color.image;
            }

            updateThumbnails() {
                const container = document.getElementById('thumbnail-images');
                const colors = this.currentProduct.colors;
                
                if (colors && colors.length > 0) {
                    container.innerHTML = colors.map((color, index) => `
                        <img src="${color.image}" alt="${color.name}" 
                             class="thumbnail ${index === 0 ? 'active' : ''}"
                             onclick="productDetail.selectColorFromThumbnail(${index})">
                    `).join('');
                }
            }

            selectColorFromThumbnail(index) {
                // Update thumbnails
                document.querySelectorAll('.thumbnail').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.thumbnail')[index].classList.add('active');
                
                // Update color selection
                this.selectColor(index);
            }

            updateCartCount() {
                const cart = JSON.parse(localStorage.getItem('cart')) || [];
                document.getElementById('cart-count').textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
            }
        }

        function changeQuantity(delta) {
            const input = document.getElementById('quantity');
            const newValue = Math.max(1, parseInt(input.value) + delta);
            const maxStock = productDetail.currentProduct.stock;
            
            if (newValue <= maxStock) {
                input.value = newValue;
                productDetail.quantity = newValue;
            }
        }

        function addToCart() {
            if (!productDetail.currentProduct) return;
            
            const product = productDetail.currentProduct;
            const variant = productDetail.selectedVariant !== null ? product.variants[productDetail.selectedVariant] : null;
            const color = productDetail.selectedColor !== null ? product.colors[productDetail.selectedColor] : null;
            
            const cartItem = {
                id: product.id,
                name: product.name,
                price: variant ? variant.price : product.price,
                image: color ? color.image : product.image,
                quantity: productDetail.quantity,
                variant: variant ? variant.storage : null,
                color: color ? color.name : null
            };
            
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existingIndex = cart.findIndex(item => 
                item.id === cartItem.id && 
                item.variant === cartItem.variant && 
                item.color === cartItem.color
            );
            
            if (existingIndex > -1) {
                cart[existingIndex].quantity += cartItem.quantity;
            } else {
                cart.push(cartItem);
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            productDetail.updateCartCount();
            
            // Show success message
            alert('Product added to cart!');
        }

        function addToWishlist() {
            alert('Added to wishlist!');
        }

        // Review Rating Stars Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const stars = document.querySelectorAll('.rating-input .star');
            const ratingInput = document.getElementById('reviewRating');
            let selectedRating = 0;

            stars.forEach((star, index) => {
                star.addEventListener('mouseover', function() {
                    highlightStars(index + 1);
                });

                star.addEventListener('mouseout', function() {
                    highlightStars(selectedRating);
                });

                star.addEventListener('click', function() {
                    selectedRating = index + 1;
                    ratingInput.value = selectedRating;
                    highlightStars(selectedRating);
                });
            });

            function highlightStars(rating) {
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.classList.add('active');
                    } else {
                        star.classList.remove('active');
                    }
                });
            }

            // Review Form Submission
            document.getElementById('reviewForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('reviewerName').value;
                const rating = parseInt(document.getElementById('reviewRating').value);
                const comment = document.getElementById('reviewComment').value;
                
                if (!rating) {
                    alert('Please select a rating!');
                    return;
                }

                // Get current product and add new review
                const productId = new URLSearchParams(window.location.search).get('id');
                const newReview = {
                    user: name,
                    rating: rating,
                    comment: comment,
                    date: new Date().toISOString().split('T')[0]
                };

                // Get existing reviews from localStorage
                let userReviews = JSON.parse(localStorage.getItem('userReviews')) || {};
                if (!userReviews[productId]) {
                    userReviews[productId] = [];
                }
                
                userReviews[productId].push(newReview);
                localStorage.setItem('userReviews', JSON.stringify(userReviews));

                // Reset form
                this.reset();
                selectedRating = 0;
                highlightStars(0);
                ratingInput.value = '';

                // Refresh reviews display
                productDetail.loadUserReviews();
                productDetail.renderReviews();

                alert('Thank you for your review!');
            });
        });

        // Initialize
        const productDetail = new ProductDetail();
    </script>
</body>
</html>

